<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Danh Sách Bài Kiểm Tra</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

    <nav class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex items-center justify-between h-16"><div class="text-sm"><a href="{{ url_for('trang_giao_vien') }}" class="font-bold text-blue-600 hover:text-blue-800">Lớp của tôi</a><span class="mx-1 text-gray-400">/</span><a href="{{ url_for('chi_tiet_lop', id_lop=lop_hoc.id) }}" class="text-blue-600 hover:text-blue-800">{{ lop_hoc.tenLop }}</a><span class="mx-1 text-gray-400">/</span><a href="{{ url_for('tao_bai_kiem_tra', id_lop=lop_hoc.id) }}" class="text-blue-600 hover:text-blue-800">Bài Kiểm Tra</a><span class="mx-1 text-gray-400">/</span><span class="text-gray-600">Danh Sách</span></div><div><a href="{{ url_for('dang_xuat') }}" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">Đăng xuất</a></div></div></div>
    </nav>

    <main class="max-w-7xl mx-auto py-10 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-4xl font-extrabold text-gray-900">Quản lý Bài kiểm tra</h1>
            <a href="{{ url_for('tao_bai_kiem_tra_moi', id_lop=lop_hoc.id) }}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded whitespace-nowrap">
                + Tạo bài kiểm tra mới
            </a>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message p-4 mb-4 text-sm rounded-lg bg-blue-100 text-blue-700" role="alert">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for bkt in danh_sach_bkt %}
            <div class="bg-white rounded-lg shadow-lg flex flex-col">
                <div class="p-6 flex-grow">
                    <h3 class="text-xl font-bold text-gray-900 mb-2">{{ bkt.tenBaiKiemTra }}</h3>
                    <p class="text-gray-600 text-sm mb-4 h-10 overflow-hidden">{{ bkt.thongTin or "Không có mô tả" }}</p>
                    <div class="flex items-center text-sm text-gray-500 mb-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <span>{{ bkt.thoiGianLamBai }} phút</span>
                    </div>
                    <div class="flex items-center text-sm text-gray-500 mb-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <span>{{ bkt.soLuongCauHoi }} câu hỏi</span>
                    </div>
                     <div class="flex items-center text-sm text-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H5v-2H3v-2H1v-4a6 6 0 017.743-5.743z" /></svg>
                        <span>{{ "Có mật khẩu" if bkt.matKhau else "Không có mật khẩu" }}</span>
                    </div>
                </div>
                <div class="bg-gray-50 px-6 py-3 flex justify-end items-center space-x-3">
                     <a href="{{ url_for('thong_ke_ket_qua', id_lop=lop_hoc.id, id_bkt=bkt.id) }}" class="text-sm font-medium text-purple-600 hover:text-purple-800">Thống kê</a>
                     <a href="{{ url_for('chi_tiet_bai_kiem_tra', id_lop=lop_hoc.id, id_bkt=bkt.id) }}" class="text-sm font-medium text-green-600 hover:text-green-800">Xem Chi Tiết</a>
                     <a href="{{ url_for('sua_bai_kiem_tra', id_lop=lop_hoc.id, id_bkt=bkt.id) }}" class="text-sm font-medium text-blue-600 hover:text-blue-800">Sửa</a>
                     <form action="{{ url_for('xoa_bai_kiem_tra', id_bkt=bkt.id) }}" method="post" onsubmit="return confirm('Bạn có chắc chắn muốn xóa bài kiểm tra này không?');">
                        <input type="hidden" name="id_lop" value="{{ lop_hoc.id }}">
                        <button type="submit" class="text-sm font-medium text-red-600 hover:text-red-800">Xóa</button>
                    </form>
                </div>
            </div>
            {% else %}
            <div class="md:col-span-2 lg:col-span-3 text-center py-12 bg-white rounded-lg shadow-lg">
                <p class="text-gray-500">Chưa có bài kiểm tra nào được tạo cho lớp này.</p>
            </div>
            {% endfor %}
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.querySelectorAll('.flash-message');
            
            flashMessages.forEach(function(message) {
                setTimeout(function() {
                    message.style.transition = 'opacity 0.5s ease';
                    message.style.opacity = '0';
                    
                    setTimeout(function() {
                        message.remove();
                    }, 500);

                }, 2000); 
            });
        });
    </script>
</body>
</html>